<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>展示界面图面</title>
    <script type="text/javascript" src="json_parse.js"></script>
    <script type="text/javascript" src="cycle.js"></script>
    <script type="text/javascript" src="json_parse_state.js"></script>
    <script type="text/javascript" src="json.js"></script>
</head>
<body>
	<div ><h1>shdsh</h1><br>
		<input type="button" name="" value="sub" onclick="start()">
	</div>
<canvas width="700" height="500" id="relation"></canvas>

<script src="jquery-2.1.4.js"></script>
<script src="jtopo-0.4.8-min.js"></script>
<script>
    function start()
    {
        var data=[{"parent_id":"1","parent_name":"bao","parent_sex":"m","parent_work":"doctor","parent_phone":"15545003191","child_id":"2","child_name":"ding","child_sex":"m","child_work":"doctors","child_phone":"2992168655","relation":3,"start_time":45,"end_time":60,"x":0,"y":-60},{"parent_id":"2","parent_name":"ding","parent_sex":"m","parent_work":"doctors","parent_phone":"2992168655","child_id":"3","child_name":"gao","child_sex":"f","child_work":"cccc","child_phone":"18838554545","relation":4,"start_time":455,"end_time":60,"x":0,"y":-120}];
        create(data);
    }


    function create(data){
        var i=0;
        var k=0;
        var parent=data[0].parent_id;

        var canvas = document.getElementById('relation');
        var stage = new JTopo.Stage(canvas); // 创建一个舞台对象
        var scene = new JTopo.Scene(stage); // 创建一个场景对象
        scene.backgroundColor="#AE0000";
        var userNode = new JTopo.Node(); // 创建一个节点
        userNode.setBound(137, 117, 66, 66); // 同时设置大小及位置
        userNode.showSelected = true; // 不显示选中矩形
        userNode.setImage('1.png'); // 设置图片
        userNode.id=5;
       userNode.click(function(event){
                // window.location.href=event.target.url;
                //alert(this);
                alert(this.id);
                });
        scene.add(userNode); // 放入到场景中

        var num=data.length,jr=true,py=true,ts=true;
        var otherNode_z=new Array(num);

        while(i<num)
        {
            var temp=data[i].parent_id;
            while(parseInt(parent)==parseInt(temp))
            {
                var otherNode = new JTopo.Node(); // 创建一个节点
                otherNode.setBound(100+data[i].x, 100+data[i].y,50, 50); // 同时设置大小及位置
                otherNode.borderRadius = 50; // 圆角
                otherNode.setImage('2.png', false); // 设置图片
                otherNode.showSelected = false; // 不显示选中矩形
                scene.add(otherNode); // 放入到场景中
                otherNode.url='#';
                otherNode.id=data[i].child_id;
                otherNode.click(function(event){
                window.location.href=event.target.url;
                //alert(this);
                alert(this.id);
                });
                otherNode_z[i]=otherNode;
                var link;
                if(parseInt(data[i].relation)==1){
                    if(jr==true){
                        jr=false;
                        link = new JTopo.Link(userNode, otherNode,data[i].relation); // 增加连线
                    }else{
                        link = new JTopo.Link(userNode, otherNode); // 增加连线
                }
                link.strokeColor ='235, 175, 66';
            }else if(parseInt(data[i].relation)==4){
                // alert("44");
                if(ts==true){
                    ts=false;
                    link = new JTopo.Link(userNode, otherNode,data[i].relation); // 增加连线
                }else{
                    link = new JTopo.Link(userNode, otherNode); // 增加连线
                }
                link.strokeColor ='242, 75, 74';
            }else if(parseInt(data[i].relation)==3){
                // alert("33");
                if(py==true){
                    py=false;
                    link = new JTopo.Link(userNode, otherNode,data[i].relation); // 增加连线
                }else{
                    link = new JTopo.Link(userNode, otherNode); // 增加连线
                }
                link.strokeColor ="61, 124, 201";
            }
                i++;
                scene.add(link);
                temp=data[i].parent_id;
            }


            var j=0;
            // alert("uu");
            while(j<i)
            {
                if(parseInt(data[j].child_id)==parseInt(data[i].parent_id))
                {
                    break;
                }
            }
            // alert("j="+j);
            userNode=otherNode_z[j];
            //alert(userNode.getImage());
            parent=data[i].parent_id;
        }

    }
</script>
</body>
</html>



